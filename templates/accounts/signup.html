{% extends '../base.html' %}
{% load static %}
{% block title %}{% endblock %}
{% block css %}

<style>
    .hero > .hero-context {
          position: absolute;
          width: 100%;
          height: 100%;
          background-image: linear-gradient(
          rgba(0,0,0,1),
          rgba(0,0,0,.7),
          rgba(0,0,0,.4),
          rgba(0,0,0,0));
        }
    .signup-form{
        background: rgba(255, 255,255, 0.25);
        backdrop-filter: blur(15px);
        border-color: #fff;
        border-bottom: 1px solid rgba(255, 255,255, 0.5);
        border-right: 1px solid rgba(255, 255,255, 0.5);
    }
    .tab{
        display:none;
    }
</style>
{% endblock %}
{% block content %}

<!-- ========== MAIN CONTENT ========== -->
    <main id="content" role="main">
         <!-- Hero -->
         <div class="bg-img-start hero" style="background-image: url(../../static/img/1920x1080/img4.jpg); min-width: 100vh; min-height: 100vh;">
            <div class="container content-space-2 content-space-t-lg-3 content-space-b-lg-3">
                <div class="row">
                    <div class="col-10 col-md-6 card mx-auto signup-form">
                        <div class="mt-5 px-3">
                            <!-- Heading -->
                            <div class="text-center mb-5 mb-md-7">
                                <h1 class="h2 text-white">Welcome to Dikkha</h1>
                                <p class="text-white">Fill out the form to get started.</p>
                            </div>
                            <!-- End Heading -->
                            <!-- Form -->
                            <form class="js-validate needs-validation" id="signupForm" action="{% url 'accounts:signup' %}" method="POST" novalidate>
                                {% csrf_token %}
                                <div class="tab">
                                    <div class="row gx-3">
                                    <div class="col-sm-6">
                                        <!-- FullName -->
                                        <div class="mb-3">
                                            <label class="form-label text-white" for="fullname">Your full name</label>
                                            <input type="text" class="form-control form-control-lg" name="fullname" id="fullname" placeholder="Your full name" aria-label="your full name" required>
                                            <span class="invalid-feedback text-white">Please enter a valid email address.</span>
                                        </div>
                                       <!-- End FullName -->
                                    </div>
                                    <div class="col-sm-6">
                                        <!-- FullName -->
                                        <div class="mb-3">
                                            <label class="form-label text-white" for="username">Your username</label>
                                            <input type="text" class="form-control form-control-lg" name="username" id="username" placeholder="Your user name" aria-label="Your user name" required>
                                            <span class="invalid-feedback text-white">Please enter a valid email address.</span>
                                        </div>
                                        <!-- End FullName -->
                                    </div>
                                    </div>
                                    <div class="row gx-3">
                                        <div class="col-sm-6">
                                            <!-- Email -->
                                            <div class="mb-3">
                                                <label class="form-label text-white" for="email">Your email</label>
                                                <input type="email" class="form-control form-control-lg" name="email" id="email" placeholder="email@gmail.com" aria-label="email@gmail.com" required>
                                                <span class="invalid-feedback text-white">Please enter a valid email address.</span>
                                            </div>
                                            <!-- End Email -->
                                        </div>
                                        <div class="col-sm-6">
                                            <!-- Contact Number -->
                                            <div class="mb-3 form-field">
                                                <label class="form-label text-white" for="contact_number">Your Contact NUmber</label>
                                                <input type="text" class="form-control form-control-lg" name="contact_number" id="contact_number" placeholder="+(88)(0)xx-xxx-xxx-xx" aria-label="+(88)(0)xx-xxx-xxx-xx" required>
                                                <span class="invalid-feedback text-white">Please enter a valid email address.</span>
                                            </div>
                                            <!-- End Contact Number -->
                                        </div>
                                    </div>  
                                    <div class="row-gx-3">
                                        <div class="col">
                                            <!-- Form -->
                                            <div class="mb-3 form-field">
                                                <label class="form-label text-white" for="password">Password</label>
                        
                                                <div class="input-group input-group-merge" data-hs-validation-validate-class>
                                                    <input type="password" class="js-toggle-password form-control form-control-lg" name="password1" id="password1" placeholder="8+ characters required" aria-label="8+ characters required" required data-hs-toggle-password-options='{
                                                    "target": [".js-toggle-password-target-1", ".js-toggle-password-target-2"],
                                                    "defaultClass": "bi-eye-slash",
                                                    "showClass": "bi-eye",
                                                    "classChangeTarget": ".js-toggle-passowrd-show-icon-1"
                                                }'>
                                                    <a class="js-toggle-password-target-1 input-group-append input-group-text" href="javascript:;">
                                                    <i class="js-toggle-passowrd-show-icon-1 bi-eye"></i>
                                                    </a>
                                                </div>
                        
                                                <span class="invalid-feedback">Your password is invalid. Please try again.</span>
                                            </div>
                                            <!-- End Form -->
                                        </div>
                                        <div class="col">
                                            <!-- Form -->
                                            <div class="mb-3">
                                                <label class="form-label text-white" for="confirm_password">Confirm password</label>
                                                    <div class="input-group input-group-merge" data-hs-validation-validate-class>
                                                        <input type="password" class="js-toggle-password form-control form-control-lg" name="password2" id="password2" placeholder="8+ characters required" aria-label="8+ characters required" required data-hs-validation-equal-field="#password1"
                                                            data-hs-toggle-password-options='{
                                                    "target": [".js-toggle-password-target-1", ".js-toggle-password-target-2"],
                                                    "defaultClass": "bi-eye-slash",
                                                    "showClass": "bi-eye",
                                                    "classChangeTarget": ".js-toggle-passowrd-show-icon-2"
                                                    }'>
                                                        <a class="js-toggle-password-target-2 input-group-append input-group-text" href="javascript:;">
                                                        <i class="js-toggle-passowrd-show-icon-2 bi-eye"></i>
                                                        </a>
                                                    </div>
                                                <span class="invalid-feedback">Password does not match the confirm password.</span>
                                            </div>
                                            <!-- End Form -->
                                        </div>
                                    </div>
                                </div>
                                <div class="tab">
                                    <div class="row gx-3">
                                        <div class="col-sm-6">
                                            <div class="mb-3">
                                            <label class="form-label text-white" for="university_level">Choose University Level</label>
                                            <select class="form-select" id="university_level" name="university_level" aria-label="Default select example" required>
                                                <option value="" selected>-----Select-----</option>
                                                <option value="graduation">Graduation</option>
                                                <option value="post_graduation">Post Graduation</option>
                                            </select>
                                            <span class="invalid-feedback text-white">Please select university level.</span>
                                          </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="mb-3">
                                                <label class="form-label text-white" for="exam_name">Degree Name</label>
                                                <select class="form-select" name="exam_name" id="exam_name" aria-label="Default select example" required disabled>
                                                    <option value="" selected>-----Select-----</option>
                                                </select>
                                                <span class="invalid-feedback text-white">Please select your degree name.</span>
                                              </div>
                                        </div>
                                    </div>

                                    <div class="row-gx-3">
                                        <div class="col">
                                                <div class="mb-3">
                                                <label class="form-label text-white" for="university">University</label>
                                                <select class="form-select" name="university" id="university" aria-label="Default select example" required>
                                                    <option value="" selected>-----Select-----</option>
                                                    {% for university in university_names %}
                                                    <option value="{{university.pk}}">{{ university.name }}</option>
                                                    {% endfor %}
                                                </select>
                                                <span class="invalid-feedback text-white">Please select your university.</span>
                                              </div>
                                        </div>
                                    </div>

                                    <div class="row gx-3">
                                        <div class="col-sm-6">
                                            <div class="mb-3">
                                                <label class="form-label text-white" for="subject">Subject</label>
                                                <select class="form-select" name="subject" id="subject" aria-label="Default select example" required>
                                                    <option value="" selected>-----Select-----</option>
                                                    {% for subject in subject_names %}
                                                    <option value="{{subject.pk}}">{{ subject.name }}</option>
                                                    {% endfor %}
                                                </select>
                                                <span class="invalid-feedback text-white">Please select your subject.</span>
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="mb-3">
                                                <label class="form-label text-white" for="which_year_student">Year</label>
                                                <select class="form-select" name="which_year_student" id="which_year_student" aria-label="Default select example" disabled>
                                                    <option value="" selected>-----Select-----</option>
                                                </select>
                                               <span class="invalid-feedback text-white">Please select in which year you are.</span>
                                              </div>
                                        </div>
                                    </div>
                                    <div class="row gx-3">
                                        <div class="col mb-3">
                                            <label class="form-label text-white me-3" for="gender">Gender</label>
                                            <div class="form-check form-check-inline" id="gender-check-box">
                                                <input class="form-check-input" type="radio" name="gender" id="male" value="MALE">
                                                <label class="form-check-label text-white" for="male">Male</label>
                                              </div>
                                              <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio" name="gender" id="female" value="FEMALE">
                                                <label class="form-check-label text-white" for="female">Female</label>
                                              </div>
                                              <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio" name="gender" id="others" value="OTHERS">
                                                <label class="form-check-label text-white" for="others">Others</label>
                                            </div>
                                            <span class="invalid-feedback text-white" id="gender-error-text">Please choose your gender.</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row gx-3" id="nextPrevious">
                                    <div class="col-sm-6" id="prevBtnCol">
                                     <div class="d-grid mb-3">
                                      <button type="button" class="btn btn-success btn-lg" id="prevBtn" onclick="nextPrev(-1)">Previous</button>
                                     </div>
                                    </div>
                                    <div class="col-sm-6" id="nextBtnCol">
                                        <div class="d-grid mb-3" id="nextBtnDiv">
                                            <button type="button" class="btn btn-primary btn-lg" id="nextBtn" onclick="nextPrev(1)">Next</button>
                                            <button type="submit" class="btn btn-primary btn-lg" id="submitBtn">Submit</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <p class="text-white">Already have an account? <a class="link" href="./page-login-simple.html">Log in here</a></p>
                                </div>
                            </form>
                            <!-- End Form -->
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
        <!-- End Hero -->
    </main>
<!-- ========== END MAIN CONTENT ========== -->

{% endblock content %}
{% block js %}
<script>
    // INITIALIZATION OF TOGGLE PASSWORD
    // =======================================================
    new HSTogglePassword('.js-toggle-password');
    
    var currentTab = 0;
    document.addEventListener("DOMContentLoaded", function(event) {
      showTab(currentTab);
    });

    function showTab(n) {
        var x = document.getElementsByClassName("tab");
        x[n].style.display = "block";
        console.log(document.getElementById("prevBtn"));
        if (n == 0) {
            document.getElementById("prevBtn").style.display = "none";
            document.getElementById("submitBtn").style.display = "none";
            document.getElementById("nextBtnCol").classList.toggle("col-sm-6");
            document.getElementById("nextBtnCol").classList.toggle("col-12");
        } else {
            document.getElementById("prevBtn").style.display = "inline";
            document.getElementById("nextBtnCol").classList.toggle("col-sm-6");
            document.getElementById("nextBtnCol").classList.toggle("col-12");
        }
        if (n == (x.length - 1)) {
            document.getElementById("nextBtn").style.display = "none";
            document.getElementById("submitBtn").style.display = "block";
        } else {
            document.getElementById("nextBtn").style.display = "block";
            document.getElementById("nextBtn").innerHTML = "Next";
        }

        // fixStepIndicator(n)
    }

    function nextPrev(n) {
        remove_invalid_text(n);
        var x = document.getElementsByClassName("tab");
        // if (n == 1 && !validateForm()) return false;
        x[currentTab].style.display = "none";
        currentTab = currentTab + n;
        
        if (currentTab >= x.length) {
            document.getElementById("nextPrevious").style.display = "none";
        }
        showTab(currentTab);
    }
    
    // removing error text
    function remove_invalid_text(n){
        current_tab = n-1;
        x = document.getElementsByClassName("tab");
        y = x[currentTab].getElementsByClassName("invalid-feedback");
        y.forEach(element => {
             element.style.display = "none";
        });
    }
    
    // form validation
    function validateForm() {
    let x, y, i, valid = true;
    x = document.getElementsByClassName("tab");
    y = x[currentTab].getElementsByTagName("input");
    z = x[currentTab].getElementsByClassName("invalid-feedback");
    
    gender_check_box = x[currentTab].querySelector("#gender-check-box");
    console.log(gender_check_box);
    checked_gender = x[currentTab].querySelector('input[name="gender"]:checked');
    console.log(checked_gender);

    m = x[currentTab].getElementsByTagName("select");
    // n = x[currentTab].getElementsByTagName("select");
    
    for (i = 0; i < y.length; i++) {
        if (y[i].value == "") {
            z[i].style.display = "block";
            valid = false;
        }else{
            if (y[i].name == "email" && !validateEmail(y[i].value)){
                z[i].style.display = "block";
                valid = false;
            }
            if (y[i].name == "contact_number" && !validateContact(y[i].value)){
                z[i].style.display = "block";
                valid = false;
            }
             
        }
    }
        if(m){
            for (i = 0; i < m.length; i++) {
            if (m[i].value == "") {
                z[i].style.display = "block";
                valid = false;
            }
        }}

        if(gender_check_box){
        if(checked_gender == null){
            document.getElementById("gender-error-text").style.display = "block";
            // z[i].style.display = "block";
            valid = false;
        }}
    // if (valid) { document.getElementsByClassName("step")[currentTab].className += " finish"; }
    return valid;
}
    // email validation
    function validateEmail(mail) {
        if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(mail))
        {
            return (true)
        }
        return (false)
    }

    // contactNumber validation
    function validateContact(contectNumber){
        if(/^(?:\+?88)?01[3-9]\d{8}$/.test(contectNumber)){
            return true;
        }else return false
    }

    if (document.getElementById("university_level")){
        document.getElementById("university_level").addEventListener("change", onChangeUniversityLevelHandler);
    }

    function onChangeUniversityLevelHandler(event){
        console.log("onchange() called...");
        let selected_university_level = event.target.options[event.target.selectedIndex].value;
        console.log(selected_university_level);

        let data = {
            "selected_university_level": selected_university_level,
        }
        $.ajax({
            type: "GET",
            url: `{% url "accounts:load-university-contents" %}`,
            data: data,
            success: function(response){
                console.log(response);
                let exam_names_menu = document.getElementById("exam_name");
                if(exam_names_menu){
                    exam_names_menu.disabled = false;
                    exam_names_menu.innerHTML = response.load_exam_names;
                }
                let which_year_student = document.getElementById("which_year_student");
                if(which_year_student){
                    which_year_student.disabled = false
                    which_year_student.innerHTML = response.load_which_years;
                }
                console.log(exam_names_menu)

            },
            error: function(errorData){
                console.log(errorData);
            },
        })
    }
    
    // Form submit
    document.getElementById("submitBtn").addEventListener("click", e=>{
        e.preventDefault();
        document.getElementsByClassName("invalid-feedback").forEach( element => {
          element.style.display = "none";
        })
        
        if(validateForm()){
          document.getElementById("signupForm").submit();
        }
    })

     
        
        // HSBsValidation.init('.js-validate', {
        //     onSubmit: data => {
        //         data.event.preventDefault()
        //         alert('Submited')
        //     }
        // })
    

</script>
{% endblock js %}